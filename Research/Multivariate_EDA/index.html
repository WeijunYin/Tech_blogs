<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Exploratory Data Analyses - Wei-Jun Yin's Blog</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Multivariate Exploratory Data Analyses\uff08EDA)", url: "#_top", children: [
              {title: "\u5bfc\u5165\u65f6\u95f4\u5e8f\u5217", url: "#_1" },
              {title: "\u5bfc\u5165\u5fc5\u8981\u7684\u5305", url: "#_2" },
              {title: "\u83b7\u53d6\u6570\u636e\u70b9\u7684\u6570\u91cf(\u6570\u636e\u63cf\u8ff0\u7684\u65f6\u5019\u4f7f\u7528)", url: "#_3" },
              {title: "\u83b7\u53d6\u6570\u636e\u7684\u7c7b\u578b", url: "#_4" },
              {title: "\u628aTimestamp\u8f6c\u5316\u4e3astrftime\u7c7b\u578b", url: "#timestampstrftime" },
              {title: "\u68c0\u67e5\u6570\u636e\u96c6\u7f3a\u5931\u7684\u503c", url: "#_5" },
              {title: "\u68c0\u67e5\u6570\u636e\u96c6\u4e2d\u91cd\u590d\u51fa\u73b0\u7684\u503c\uff08\u5b9e\u9645\u4e0a\u6211\u4eec\u5e76\u4e0d\u60f3\u8981\uff09", url: "#_6" },
              {title: "\u83b7\u53d6\u6570\u636e\u96c6\u7684\u6bcf\u4e00\u5217\u7684\u7edf\u8ba1\u4fe1\u606f", url: "#_7" },
              {title: "\u6dfb\u52a0\u4e00\u5217\u7279\u5f81(\u7279\u5f81\u5de5\u7a0b\u7684\u57fa\u7840)", url: "#_8" },
              {title: "\u663e\u793a\u7279\u5f81\u5de5\u7a0b\u540e\u7684\u5e8f\u5217\u7684\u4fe1\u606f", url: "#_9" },
              {title: "\u4f7f\u7528\u4e24\u5217\u753b\u51fa\u6563\u70b9\u56fe(\u4f7f\u7528\u6563\u70b9\u56fe\u753b\u51fa\u65f6\u95f4\u5e8f\u5217)", url: "#_10" },
              {title: "\u8bbe\u7f6e\u7d22\u5f15\u5e76\u4e14\u5728\u539f\u6765\u7684\u6570\u636e\u4e0a\u66f4\u6539", url: "#_11" },
              {title: "\u5212\u5206\u9884\u6d4b\u7684\u503c\u548c\u7279\u5f81", url: "#_12" },
              {title: "\u5212\u5206\u6570\u636e\u96c6", url: "#_13" },
              {title: "\u5b9a\u4e49\u6a21\u578b\uff1a \u8fd9\u91cc\u4f7f\u7528tensorflow\u6765\u5b9e\u73b0", url: "#tensorflow" },
              {title: "\u5bf9\u5df2\u7ecf\u5b9a\u4e49\u597d\u7684\u6a21\u578b\u5b9e\u884c\u9884\u6d4b\uff0c\u5e76\u4e14\u8f93\u51faMSE\u7684\u8bef\u5dee\u503c", url: "#mse" },
              {title: "\u6253\u5370\u6bcf\u79cd\u9884\u6d4b\u6a21\u578b\u7684\u8bef\u5dee", url: "#_14" },
              {title: "\u4f7f\u7528\u81ea\u5b9a\u4e49\u51fd\u6570\u6765\u8ba1\u7b97\u8bef\u5dee", url: "#_15" },
              {title: "Tensorflow\u4fdd\u5b58\u6a21\u578b", url: "#tensorflow_1" },
              {title: "\u6311\u9009\u51fa\u4e00\u4e2a", url: "#_16" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="../../javascripts/mathjax.js"></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <h2 id="multivariate-exploratory-data-analyseseda">Multivariate Exploratory Data Analyses（EDA)<a class="headerlink" href="#multivariate-exploratory-data-analyseseda" title="Permanent link">#</a></h2>
<p>Exploratory Data Analyses (EDA) 叫做数据探索性分析，是用来在对时间序列处理前先进行数据</p>
<p>单变量时间序列是有多个变量的（除时间外）的序列，下面我们考虑单变量时间序列的EDA问题</p>
<h3 id="_1">导入时间序列<a class="headerlink" href="#_1" title="Permanent link">#</a></h3>
<pre><code class="language-python">import pandas as pd
df=pd.read_csv('TexasTurbine.csv')

# 打印前二十行
df.head(20)
</code></pre>
<h3 id="_2">导入必要的包<a class="headerlink" href="#_2" title="Permanent link">#</a></h3>
<pre><code class="language-python">import numpy as np
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt
plt.style.use(&quot;Solarize_Light2&quot;)  #using style ggplot

%matplotlib inline
from mpl_toolkits.mplot3d import Axes3D
import datetime as dt
import plotly.graph_objects as go
import plotly.express as px
import datetime as dt
</code></pre>
<h3 id="_3">获取数据点的数量(数据描述的时候使用)<a class="headerlink" href="#_3" title="Permanent link">#</a></h3>
<pre><code class="language-python">df.shape
</code></pre>
<h3 id="_4">获取数据的类型<a class="headerlink" href="#_4" title="Permanent link">#</a></h3>
<pre><code class="language-python">df.info()
</code></pre>
<h3 id="timestampstrftime">把Timestamp转化为strftime类型<a class="headerlink" href="#timestampstrftime" title="Permanent link">#</a></h3>
<pre><code class="language-python">df['Time stamp'] = pd.to_datetime(df['Time stamp'], format='%b %d, %I:%M %p').dt.strftime('%b %d %H:%M:%S.%f')
</code></pre>
<h3 id="_5">检查数据集缺失的值<a class="headerlink" href="#_5" title="Permanent link">#</a></h3>
<pre><code class="language-python">df.isnull().sum()
</code></pre>
<h3 id="_6">检查数据集中重复出现的值（实际上我们并不想要）<a class="headerlink" href="#_6" title="Permanent link">#</a></h3>
<pre><code class="language-python"># 输出重复数据的数量
df.duplicated().sum()

# 用布尔值说明数据是否重复(最开始的那一个显示False) 
df.duplicated() 

# 筛选病展示重复数据
df[df.duplicated()]

# 去掉重复的数据 
df.drop_duplicates()
</code></pre>
<h3 id="_7">获取数据集的每一列的统计信息<a class="headerlink" href="#_7" title="Permanent link">#</a></h3>
<pre><code class="language-python"># round(2) 保留小数点后两位
df.describe().round(2)
</code></pre>
<h3 id="_8">添加一列特征(特征工程的基础)<a class="headerlink" href="#_8" title="Permanent link">#</a></h3>
<pre><code class="language-python"># 添加一列特征，这个特征是月份
df[&quot;Month&quot;]=df[&quot;Time stamp&quot;].dt.month
</code></pre>
<h3 id="_9">显示特征工程后的序列的信息<a class="headerlink" href="#_9" title="Permanent link">#</a></h3>
<pre><code class="language-python">df.info()
</code></pre>
<h3 id="_10">使用两列画出散点图(使用散点图画出时间序列)<a class="headerlink" href="#_10" title="Permanent link">#</a></h3>
<pre><code class="language-python">plt.figure(figsize=(17,8))

# Time stamp是一列
# System power generated | (kW) 是一列
sns.scatterplot(data=df,x=&quot;Time stamp&quot;,y=&quot;System power generated | (kW)&quot;,)
plt.title(&quot;Effect the time by the system power&quot;)
plt.show()
</code></pre>
<h3 id="_11">设置索引并且在原来的数据上更改<a class="headerlink" href="#_11" title="Permanent link">#</a></h3>
<pre><code class="language-python"># 索引是列名为Time stamp的列
df.set_index(&quot;Time stamp&quot;,inplace=True)
</code></pre>
<h3 id="_12">划分预测的值和特征<a class="headerlink" href="#_12" title="Permanent link">#</a></h3>
<p>这是由于特征和目标在同一个数据列表里面，所以需要分开</p>
<pre><code class="language-python"># X 是特征
X = df.drop(columns=&quot;System power generated | (kW)&quot;)  

# y 是要预测的量
y = df[&quot;System power generated | (kW)&quot;]    # y = system power generated 
</code></pre>
<h3 id="_13">划分数据集<a class="headerlink" href="#_13" title="Permanent link">#</a></h3>
<pre><code class="language-python"># 划分数据集
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.30, random_state=42)

# 打印数据的数量，注意y应该是形如(2628，),而X应该是形如(6132,5)，5是特征数
# 5当中 不包含timestamp这一列
print(&quot;X Train : &quot;, X_train.shape)
print(&quot;X Test  : &quot;, X_test.shape)
print(&quot;Y Train : &quot;, y_train.shape)
print(&quot;Y Test  : &quot;, y_test.shape)
</code></pre>
<h3 id="tensorflow">定义模型： 这里使用tensorflow来实现<a class="headerlink" href="#tensorflow" title="Permanent link">#</a></h3>
<pre><code class="language-python">LR = LinearRegression()
DTR = DecisionTreeRegressor()
RFR = RandomForestRegressor()
KNR = KNeighborsRegressor()
MLP = MLPRegressor()
XGB = XGBRegressor()
SVR = SVR()
</code></pre>
<h3 id="mse">对已经定义好的模型实行预测，并且输出MSE的误差值<a class="headerlink" href="#mse" title="Permanent link">#</a></h3>
<pre><code class="language-python"># 不同的训练好的模型
li = [LR,DTR,RFR,KNR,KNR,XGB,SVR]

# 误差列表
d = {}
for i in li:

    # 进行预测
    i.fit(X_train,y_train)

    #计算误差
    ypred = i.predict(X_test)

    # 打印出来误差
    print(i,&quot;:&quot;,r2_score(y_test,ypred)*100)

    # 保存误差
    d.update({str(i):i.score(X_test,y_test)*100})
</code></pre>
<h3 id="_14">打印每种预测模型的误差<a class="headerlink" href="#_14" title="Permanent link">#</a></h3>
<pre><code class="language-python">plt.figure(figsize=(30, 6))
plt.title(&quot;Algorithm vs Accuracy&quot;)
plt.xlabel(&quot;Algorithm&quot;)
plt.ylabel(&quot;Accuracy&quot;)
plt.plot(d.keys(),d.values(),marker='o',color='red')
plt.show()
</code></pre>
<h3 id="_15">使用自定义函数来计算误差<a class="headerlink" href="#_15" title="Permanent link">#</a></h3>
<pre><code class="language-python"># 得到预测序列
ypred_xgb=XGB.predict(X_test)

# 计算误差
import math
from sklearn.metrics import mean_squared_error
math.sqrt(mean_squared_error(y_test,ypred_xgb))
</code></pre>
<h3 id="tensorflow_1">Tensorflow保存模型<a class="headerlink" href="#tensorflow_1" title="Permanent link">#</a></h3>
<pre><code class="language-python">import pickle 
pickle.dump(XGB,open('model.pkl','wb'))
</code></pre>
<h3 id="_16">挑选出一个<a class="headerlink" href="#_16" title="Permanent link">#</a></h3>
<pre><code class="language-python"># 导入对应的包
import numpy as np
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import LSTM
from tensorflow.keras.layers import Dense
from tensorflow.keras.layers import Flatten

df.head()
df1=df.reset_index()['System power generated | (kW)']
df1.shape
</code></pre>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Day2/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Day2/" class="btn btn-xs btn-link">
        Day 2
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../dataset_description/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../dataset_description/" class="btn btn-xs btn-link">
        Wind energy dataset
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>